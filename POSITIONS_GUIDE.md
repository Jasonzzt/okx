# 持仓管理说明

## 持仓配置文件：`positions.json`

该文件用于记录你的当前持仓信息，AI 分析师会根据这些信息给出针对性的建议。

### 文件格式

```json
[
  {
    "inst_id": "ETC-USDT-SWAP",
    "size": 30.6,
    "entry_price": 15.22,
    "direction": "long",
    "leverage": 10,
    "take_profit": 15.5,
    "stop_loss": 14.95,
    "open_time": "2025-11-03 20:00:00"
  }
]
```

### 字段说明

- **inst_id**: 产品ID（如 `ETC-USDT-SWAP`、`BTC-USDT-SWAP`）
- **size**: 持仓数量
- **entry_price**: 开仓价格
- **direction**: 方向
  - `long`: 做多
  - `short`: 做空
- **leverage**: 杠杆倍数（如 `10` 表示 10x 杠杆）
- **take_profit**: 止盈价格
- **stop_loss**: 止损价格
- **open_time**: 开仓时间（可选）

### 多个持仓示例

如果你有多次购入，可以添加多个持仓记录：

```json
[
  {
    "inst_id": "ETC-USDT-SWAP",
    "size": 30.6,
    "entry_price": 15.22,
    "direction": "long",
    "leverage": 10,
    "take_profit": 15.5,
    "stop_loss": 14.95,
    "open_time": "2025-11-03 20:00:00"
  },
  {
    "inst_id": "ETC-USDT-SWAP",
    "size": 20.0,
    "entry_price": 15.45,
    "direction": "long",
    "leverage": 10,
    "take_profit": 15.8,
    "stop_loss": 15.1,
    "open_time": "2025-11-03 21:30:00"
  },
  {
    "inst_id": "BTC-USDT-SWAP",
    "size": 0.5,
    "entry_price": 35000,
    "direction": "short",
    "leverage": 5,
    "take_profit": 34000,
    "stop_loss": 36000,
    "open_time": "2025-11-03 19:00:00"
  }
]
```

## AI 分析功能

当系统检测到持仓信息后，AI 分析师会：

1. **实时计算盈亏**：显示当前盈亏金额和百分比
2. **监控止盈止损**：检测是否触发止盈或止损价位
3. **调整建议**：建议是否需要调整止盈止损点位，并给出具体价格
4. **持仓操作**：建议是否需要加仓、部分平仓或全部平仓
5. **紧急提醒**：当需要立即操作时，会发送邮件通知

## 邮件提醒触发条件

系统会在以下情况发送邮件：

1. ✅ **紧急操作**：AI 判断需要立即买入或卖出
2. ✅ **止盈止损调整**：建议调整止盈或止损价格
3. ✅ **平仓建议**：建议全部或部分平仓
4. ✅ **高信心度交易建议**：信心度超过阈值的买卖建议

## 示例输出

```
======================================================================
📊 ETC-USDT-SWAP 分析结果
⏰ 时间: 2025-11-03 20:30:00
💰 当前价格: 15.35 USDT
🎯 建议: HOLD (信心度: 75.0%)
📈 持仓操作: HOLD
⚙️  止盈止损调整建议:
   止盈: 15.6
   止损: 15.0
   理由: 市场趋势向上，建议提高止盈点位，同时调整止损保护利润
📋 分析总结: 当前价格已突破阻力位，建议持有等待更高价位...
======================================================================
```

## 无持仓情况

如果 `positions.json` 为空数组 `[]` 或文件不存在，AI 会：
- 仅提供市场分析和交易建议
- 不包含持仓相关的操作建议
- 专注于新开仓的买卖时机

## 注意事项

⚠️ **重要**：
- 确保 `positions.json` 文件格式正确，否则可能导致解析失败
- 开仓、平仓后记得手动更新文件
- 所有价格和数量建议仅供参考，不构成投资建议
- 加密货币交易风险极高，请谨慎决策
